<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Virginia Beach Housing Study Update - 2&nbsp; Data and methodological notes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./hh-trends.html" rel="next">
<link href="./intro.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./intro.html">Introduction</a></li><li class="breadcrumb-item"><a href="./data-methods-notes.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data and methodological notes</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Virginia Beach Housing Study Update</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/housingforwardva/virginia-beach" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="./virginia-beach-housing-study-update.docx" rel="" title="Download Docx" class="quarto-navigation-tool px-1" aria-label="Download Docx"><i class="bi bi-file-word"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./executive-summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Executive summary</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Introduction</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-methods-notes.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data and methodological notes</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Data findings</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hh-trends.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Household Trends</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./market.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Market Dynamics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./affordability.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Housing Affordability</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./conclusions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Conclusions</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">Solutions</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./current-efforts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Current housing efforts</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./solutions-overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Overview</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Strategic priorities</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sp-htf.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Develop a City-managed Housing Trust Fund</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sp-vbda.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Expand VBDA’s housing role</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sp-education.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Design housing education campaign</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#quantitative-analysis" id="toc-quantitative-analysis" class="nav-link active" data-scroll-target="#quantitative-analysis"><span class="header-section-number">2.1</span> Quantitative analysis</a></li>
  <li><a href="#qualitative-analysis" id="toc-qualitative-analysis" class="nav-link" data-scroll-target="#qualitative-analysis"><span class="header-section-number">2.2</span> Qualitative analysis</a></li>
  <li><a href="#important-terms-and-references" id="toc-important-terms-and-references" class="nav-link" data-scroll-target="#important-terms-and-references"><span class="header-section-number">2.3</span> Important Terms and References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data and methodological notes</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="quantitative-analysis" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="quantitative-analysis"><span class="header-section-number">2.1</span> Quantitative analysis</h2>
<p>The <a href="https://www.census.gov/programs-surveys/acs/microdata/access.html">American Community Survey (ACS) Public Use Microdata Sample (PUMS)</a> is VCHR’s main source of information on city households, including demographic profile (e.g., family size, family type, householder age); occupancy characteristics (e.g., number of occupants, presence of children, seniors, elderly, and/or people with disabilities); and tenure (i.e., whether the household rents or owns the home where they live). The ACS PUMS also enables VCHR to create custom tabulations of U.S. Census data: households headed by a millennial, households headed by a baby boomer, households with one or more senior members, households by income, etc. VCHR analyzed five-year estimates from 2021, the most recent data year at the time of writing. In limited circumstances, VCHR used one-year data for analysis but has reported five-year data throughout the report for consistency. One-year estimates were not reliable for many sub-population measures.</p>
<p>In rare instances, VCHR used the ACS published tables to conduct analysis over time. Household non-response increased substantially in the ACS during the COVID-19 pandemic because of the challenges of conducting a household survey, especially for households with lower socioeconomic status — those most likely to experience housing cost burden and other housing-related challenges. Although the Census Bureau has refined its methodology to reduce the effect of non-response bias owing to the COVID-19 pandemic, the organization still labels 2020 data as experimental. As such, VCHR has omitted 2020 ACS data from longitudinal analysis and, where necessary, represented the period from 2019 to 2021 as a broken line.</p>
<p>VCHR used a special ACS tabulation called Consolidated Housing Affordability Strategy (CHAS) data to estimate the degree to which economic means of households are matched with affordability of the housing supply. The housing affordability gap analysis can be found in the [“Housing Affordability”] section of the report. The CHAS data designates each unit as affordable to specific income levels based on the size of the unit, the unit’s value or rent, and the level of income required for a household of corresponding size to affordably rent or own the unit. The CHAS tabulation also provides data on the income levels of occupants currently living in units at each unit affordability level.</p>
<p>VCHR used 2020 OnTheMap data from the U.S. Census Bureau’s Center for Economic Studies to analyze commuting patterns and identify groups that disproportionately commute into the city for work. VCHR described the inflow and outflow of workers in the city and documented trends of note by worker’s income, age, and industry. Full details can be found in the [“Workforce Housing Affordability”] section of the report.</p>
<p>VCHR’s workforce housing affordability analysis compares maximum affordable housing costs by occupation to city housing costs to determine which workers may struggle to afford housing in the city or may commute from outside the city because they cannot find appropriate, affordable housing close to their job.</p>
<p>Using May 2022 annual wage data of the Virginia Beach-Norfolk-Newport News MSA from the Bureau of Labor Statistics, VCHR calculated maximum affordable monthly housing costs (30% of monthly income) for each occupation using three scenarios:</p>
<ul>
<li>A single earner with a median wage</li>
<li>A single earner with a 90th percentile wage to represent highly skilled or experienced workers</li>
<li>Two earners with a median wage for a single occupation to represent a dual-earner household</li>
</ul>
<p>VCHR used 2021 ACS survey data on median gross rent and median selected monthly owner costs with a mortgage to define housing costs. Full details regarding the workforce housing affordability analysis methodology can be found in [Appendix X.]</p>
<p>The concept of <em>Naturally Occurring Affordable Housing</em> (NOAH) has gained attention as home prices and rents increase rapidly and as housing affordability, from both homeownership and rental perspectives, remains a pressing concern for residents in many cities. NOAH refers to affordable housing units that arise in the marketplace without specific incentives or regulations.</p>
<p>VCHR used FY 2022 Income Limits from the Department of Housing and Urban Development (HUD) to categorize affordability levels for 145,498 units in Virginia Beach assessment data. The NOAH analysis is driven by two primary objectives:</p>
<ol type="1">
<li>To realistically gauge the costs for low- to moderate-income households to own a home and to evaluate how many homes in the current market align with their affordability thresholds</li>
<li>To estimate the availability of affordable rental multifamily units in the market</li>
</ol>
<p>For homeownership, VCHR relies on assessment data, with supplemental datasets helping to estimate other associated costs (e.g., insurance, utilities, HOA and condo fees, interest rates), ultimately leading to the computation of the monthly payment. For rental, VCHR employs CoStar data, extracted in May 2023, to derive monthly housing costs for multifamily units. Full details regarding the NOAH analysis methodology can be found in [Appendix X.]</p>
<p>VCHR analyzed 2015-2022 home sale data provided by the Real Estate Information Network (REIN) on behalf of the Hampton Roads Realtors Association. VCHR used this data to analyze trends and demand in the homeownership market. VCHR further used this data to adjust assessed value to estimated current market value and to estimate HOA and condo fees for the NOAH analysis.</p>
<p>In addition to using CoStar data to categorize rental units by affordability, VCHR used CoStar data to supplement ACS data on rental market trends. VCHR reviewed 2023-Q1 CoStar data on rental vacancy rate and rental absorption rates to provide a more current perspective on rental market trends.</p>
<p>The City of Virginia Beach provided data including real estate assessment data; data on existing income-restricted housing and on building trends; and housing policies, plans, and prior studies. VCHR used this data throughout its analysis and documented its use in the source lines of graphs and tables. VCHR and HFV used information regarding housing policies and plans to develop solutions. In instances where analysis was not included in this scope of work but has been conducted elsewhere, VCHR noted those references for the reader.</p>
</section>
<section id="qualitative-analysis" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="qualitative-analysis"><span class="header-section-number">2.2</span> Qualitative analysis</h2>
<p>Qualitative data from experts, stakeholders, and citizens helped the study team assess the validity of quantitative data analysis, identify additional topics for analysis, and contextualize study findings. VCHR has summarized themes of the discussions as a whole to promote earnest conversation and protect the anonymity of participants. Details regarding the data collection approach and findings are documented here and in the report appendices.</p>
<p>VCHR collaborated with Virginia Beach staff to conduct public engagement. VCHR designed a public engagement protocol to be used for in-person meetings and to collect data from residents online through the Virginia Beach town hall online platform. VCHR and City staff conducted one virtual and five in-person engagement sessions and received 109 responses to protocol questions on the town hall platform. Summaries of in-person and online responses are included in the report appendices.&nbsp;</p>
<p>Local experts such as builders, developers, REALTORS lenders, housing service providers, employers, business groups (i.e.&nbsp;resort area contingency and Town Center business), and school representatives are valuable resources in understanding housing-related challenges and opportunities. VCHR partnered with city staff to conduct eight focus groups with these experts. Themes from these focus groups are documented throughout the report and summarized in the report appendices.</p>
<p>VCHR collaborated with HFV to conduct interviews of each Virginia Beach sitting councilmember. Interviews with councilmembers had a dual focus: (1) collecting information about housing challenges by district and perceptions regarding the role of housing in the broader well-being of the city, and (2) understanding perspectives on policy and programs to gauge councilmembers’ willingness/inclination to make policy or to dedicate funds and other resources. Questions focused on prior and current efforts to expand housing affordability, complementary initiatives in economic development and similar sectors, and aspirational goals for housing in the city.</p>
</section>
<section id="important-terms-and-references" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="important-terms-and-references"><span class="header-section-number">2.3</span> Important Terms and References</h2>
<p><strong>Tenure</strong></p>
<p>The term “tenure” refers to the method by which a household possesses their home: renting, fully owned with no home loan, or owned with a mortgage or other home loan.</p>
<p><strong>Cost-burdened Households</strong></p>
<p>The U.S. Department of Housing and Urban Development (HUD) established the term “cost-burdened” to describe households who need more affordable housing. HUD defines cost-burdened households as “families who pay more than 30% of their income for housing... and may have difficulty affording necessities such as food, clothing, transportation, and medical care.” Severely cost-burdened households pay 50% or more of their income for housing and are likely to be making tough choices between housing and other necessities.</p>
<p><strong>Percent of Area Median Income (AMI)</strong></p>
<p>HUD sets income limits by household size that determine eligibility for assisted housing programs. HUD develops these income limits based on Median Family Income estimates and Fair Market Rent (FMR) area definitions for each metropolitan area, parts of some metropolitan areas, and each non-metropolitan county. These income limits are useful tools for assessing housing needs because they standardize income-based household categories while considering household size. The 2021 and 2023 income limits for the Virginia Beach HUD Metro Fair Market Rent Area are provided for reference, and the appropriate annual income limits based on data vintage were applied in the analysis.</p>
<p><strong>Housing Affordability</strong></p>
<p>Housing affordability is a broad term used to discuss the degree to which housing units in a market or submarket meet the income-based needs of households in that market. Researchers and practitioners generally consider housing affordability for income groups that may face challenges related to affording housing, including (but not limited to) the following:</p>
<ul>
<li>extremely low-income households who do not make enough money to obtain decent hous</li>
<li>young workers who wish to become homeowners but cannot find a starter home with associated costs within their bud</li>
<li>established owners who cannot find an appropriate home to “upgrade” to as their families grow and they enter their professional pr</li>
<li>seniors who struggle to find affordable, accessible housing that meets their needs, including maintenance and modifications to make their existing homes suitable for aging</li>
</ul>
<p>Housing affordability is not usually a concern for higher-income households who can obtain their desired housing without sacrificing other household needs such as safety, transportation, medical care, food, education, and childcare. However, a shortage of housing for households at any income level may affect businesses expanding in the market or economic development efforts for attracting new businesses.</p>
<p><strong>Householder</strong></p>
<p>This report refers to “householders” when the available data pertains to the householder as defined by the U.S. Census: “the householder refers to the person (or one of the people) in whose name the housing unit is owned or rented (maintained) or, if there is no such person, any adult member, excluding roomers, boarders, or paid employees. If the house is owned or rented jointly by a married couple, the householder may be either the husband or the wife. The person designated as the householder is the ‘reference person’ to whom the relationship of all other household members, if any, is recorded.”</p>
<!--  -->


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./intro.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./hh-trends.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Household Trends</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>